
version: 3.4
name: Foreign Travel & Settlement Decision System

purpose: >
  End-to-end astrological decision system for foreign travel, long stay,
  settlement, and return analysis with explainability, confidence scoring,
  visual chart support (D1 & D9), and age-based timeline modeling.

canonical_format: yaml

inputs:
  birth_details:
    - name
    - date_of_birth
    - time_of_birth
    - place_of_birth

  chart_data:
    chart_style:
      enum: [north_indian, south_indian]
      description: Preferred chart rendering style

    d1_chart:
      required: true
      description: Rasi (D1) chart visual
      supported_formats: [svg, png, img, html]

    d9_chart:
      required: true
      description: Navamsa (D9) chart visual
      supported_formats: [svg, png, img, html]

    planetary_positions_table:
      required: true
      fields:
        - planet
        - sign
        - sign_lord
        - nakshatra
        - nakshatra_lord
        - degree
        - retrograde
        - avastha
        - house_from_lagna
        - status

optional_inputs:
  - known_foreign_events
  - dasha_periods
  - current_residence

override_rules:
  reality_override:
    - if continuous_foreign_residence_years >= 10:
        physical_settlement: true
    - if no_foreign_travel_recorded:
        archetype: NON_MOVER

houses:
  short_travel: 3
  business_travel: 7
  long_travel: 9
  foreign_residence: 12

decision_tree:
  steps:
    - evaluate_foreign_trigger
    - evaluate_long_stay_potential
    - evaluate_physical_settlement
    - evaluate_emotional_anchor
    - assign_archetype

archetypes:
  - NON_MOVER
  - VISITOR
  - LONG_STAY_RETURNER
  - DUAL_ANCHOR
  - PERMANENT_SETTLER

timeline:
  type: age_based
  start_age: 0
  end_age: 80
  interval_years: 8
  buckets:
    - "0-8"
    - "8-16"
    - "16-24"
    - "24-32"
    - "32-40"
    - "40-48"
    - "48-56"
    - "56-64"
    - "64-72"
    - "72-80"

timeline_point_requirements:
  required_fields:
    - age_range
    - calendar_range_optional
    - confidence_score
    - archetype_hint
    - dominant_factors
    - suppressing_factors
    - real_event_override

confidence_scoring:
  interval_years: 8
  score_range: [0,100]
  explainable: true

  bands:
    0-20: none
    21-40: weak
    41-60: moderate
    61-80: strong
    81-100: very_strong

  additive_factors:
    rahu_md_or_ad: 25
    saturn_md_or_ad: 20
    lord_9_active: 15
    lord_12_active: 20
    lagna_lord_9_or_12: 15
    strong_transit: 10
    known_foreign_event: 30

  subtractive_factors:
    strong_4th_house: -15
    strong_moon_anchor: -10
    known_return_event: -20

outputs:
  required_sections:
    - profile
    - chart_selector
    - d1_chart_visual
    - d9_chart_visual
    - planetary_positions_table
    - why
    - when
    - where
    - settlement_status
    - archetype
    - confidence_timeline
    - final_verdict

disallowed:
  - missing_d1_or_d9_chart
  - non_explainable_confidence_scores
  - timelines_not_covering_0_to_80
