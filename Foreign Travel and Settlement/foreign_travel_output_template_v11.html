
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Foreign Travel & Settlement Analysis</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: system-ui; background:#0b1220; color:#e5e7eb; padding:32px; }
h1,h2,h3 { color:#60a5fa; }
.card { background:#020617; padding:18px; margin-bottom:24px; border-left:4px solid #60a5fa; border-radius:12px; }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.badge { padding:4px 12px; border-radius:999px; font-size:0.85em; margin-right:6px; }
.physical { background:#22c55e; color:#022c22; }
.emotional { background:#facc15; color:#422006; }
.trend { background:#38bdf8; color:#022c22; }
</style>
</head>
<body>

<h1>Foreign Travel & Settlement Analysis</h1>

<div class="card">
  <p><strong>Name:</strong> {{name}}</p>
  <p><strong>DOB:</strong> {{dob}}</p>
  <p><strong>Place:</strong> {{place}}</p>
  <p><strong>Homeland:</strong> {{country_of_birth}}</p>
  <p><strong>Chart Style:</strong> {{chart_style}}</p>
</div>

<div class="grid">
  <div class="card">
    <h2>D1 (Rasi Chart)</h2>
    {{d1_chart_visual}}
  </div>
  <div class="card">
    <h2>D9 (Navamsa Chart)</h2>
    {{d9_chart_visual}}
  </div>
</div>

<div class="card">
  <h2>WHY</h2>
  {{why_analysis}}
</div>

<div class="card">
  <h2>WHEN</h2>
  {{when_analysis}}
</div>

<div class="card">
  <h2>WHERE</h2>
  {{where_analysis}}
</div>

<div class="card">
  <h2>Settlement Status</h2>
  <span class="badge physical">Physical: {{physical_settlement}}</span>
  <span class="badge emotional">Emotional Roots: {{emotional_roots}} ({{country_of_birth}})</span>
  <span class="badge trend">Trend: <span id="trendLabel"></span></span>
</div>

<div class="card">
  <h2>Confidence Timeline (Age Buckets)</h2>
  <canvas id="confidenceChart" height="120"></canvas>
</div>

<div class="card">
  <h2>Final Verdict</h2>
  {{final_summary}}
</div>

<script>
const dataPoints = {{confidence_data}};

function calculateTrend(data) {
  let diffs=[];
  for(let i=1;i<data.length;i++){ diffs.push(data[i].score-data[i-1].score); }
  const avg = diffs.reduce((a,b)=>a+b,0)/diffs.length;
  if(avg>2) return "Rising";
  if(avg<-2) return "Falling";
  return "Flat";
}

document.getElementById("trendLabel").innerText = calculateTrend(dataPoints);

new Chart(document.getElementById("confidenceChart"), {
  type:"line",
  data:{
    labels:dataPoints.map(d=>d.age_range),
    datasets:[{ data:dataPoints.map(d=>d.score), borderColor:"#60a5fa", tension:0.3 }]
  },
  options:{ scales:{ y:{min:0,max:100} } }
});
</script>

</body>
</html>
