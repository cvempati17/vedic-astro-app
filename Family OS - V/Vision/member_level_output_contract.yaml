version: 2.0
module: vision
contract_type: member_level_output
binding_mode: strict
rendering_mode: template_emission_only

# ==================================================
# GLOBAL CONTRACT RULES
# ==================================================

global_constraints:
  allow_free_text: false
  allow_paraphrasing: false
  allow_synonyms: false
  allow_fallback_generation: false
  allow_template_substitution: false

  failure_mode:
    on_invalid_archetype: CONTRACT_VIOLATION
    on_invalid_template_key: CONTRACT_VIOLATION
    on_missing_required_block: CONTRACT_VIOLATION

  template_authority:
    file: vision_narrative_templates.yaml
    enforcement: mandatory

# ==================================================
# REQUIRED OUTPUT SECTIONS (ORDERED)
# ==================================================

required_sections:
  - family_vision_unified
  - father_vision_role
  - mother_vision_role
  - child_vision_role
  - family_vision_alignment_summary
  - family_guiding_vision_principle

# ==================================================
# FAMILY-LEVEL OUTPUT CONTRACT
# ==================================================

family_vision_unified:
  clarity_level:
    type: enum
    allowed:
      - clarity_high
      - clarity_moderate
      - clarity_low

  allowed_template_keys:
    - FAMILY_VISION_UNIFIED_HIGH
    - FAMILY_VISION_UNIFIED_MODERATE
    - FAMILY_VISION_UNIFIED_LOW

  combined_variant_support: true
  combined_variant_source:
    file: vision_narrative_templates.yaml
    section: family_vision_combined_variants

# ==================================================
# FATHER — MEMBER OUTPUT CONTRACT
# ==================================================

father:
  role: father

  archetype:
    type: enum
    allowed:
      - "Principle Holder & Moral Compass"

  narrative_blocks:

    role_description:
      required: true
      allowed_template_keys:
        - FATHER_ROLE_BASE

    distortion_pattern:
      required: true
      severity:
        type: enum
        allowed:
          - mild
          - moderate
          - severe
      allowed_template_keys:
        - FATHER_DISTORTION_MILD
        - FATHER_DISTORTION_MODERATE
        - FATHER_DISTORTION_SEVERE

    healthy_expression:
      required: true
      allowed_template_keys:
        - FATHER_HEALTHY_EXPRESSION

# ==================================================
# MOTHER — MEMBER OUTPUT CONTRACT
# ==================================================

mother:
  role: mother

  archetype:
    type: enum
    allowed:
      - "Emotional Translator & Sustainer"

  narrative_blocks:

    role_description:
      required: true
      allowed_template_keys:
        - MOTHER_ROLE_BASE

    distortion_pattern:
      required: true
      severity:
        type: enum
        allowed:
          - mild
          - moderate
          - severe
      allowed_template_keys:
        - MOTHER_DISTORTION_MILD
        - MOTHER_DISTORTION_MODERATE
        - MOTHER_DISTORTION_SEVERE

    healthy_expression:
      required: true
      allowed_template_keys:
        - MOTHER_HEALTHY_EXPRESSION

# ==================================================
# CHILD — MEMBER OUTPUT CONTRACT
# ==================================================

child:
  role: child

  archetype:
    type: enum
    allowed:
      - "Future Direction Carrier"

  narrative_blocks:

    role_description:
      required: true
      allowed_template_keys:
        - CHILD_ROLE_BASE

    generational_mode:
      required: true
      mode:
        type: enum
        allowed:
          - adaptive
          - conflicted
          - suppressed
      allowed_template_keys:
        - CHILD_MODE_ADAPTIVE
        - CHILD_MODE_CONFLICTED
        - CHILD_MODE_SUPPRESSED

    evolution_framing:
      required: true
      allowed_template_keys:
        - CHILD_EVOLUTION_FRAMING

# ==================================================
# PARENT → CHILD TRANSITION (OPTIONAL BUT LOCKED)
# ==================================================

parent_child_transition:
  enabled: true
  allowed_template_keys:
    - PARENT_CHILD_HANDOFF_STABILIZED
    - PARENT_CHILD_OVERPROTECTION

  emission_rules:
    max_blocks: 1
    selection_basis:
      - clarity_level
      - child_generational_mode

# ==================================================
# FAMILY ALIGNMENT SUMMARY CONTRACT
# ==================================================

family_vision_alignment_summary:
  alignment_level:
    type: enum
    allowed:
      - aligned
      - moderately_aligned
      - misaligned

  allowed_template_keys:
    - FAMILY_ALIGNMENT_ALIGNED
    - FAMILY_ALIGNMENT_MODERATE
    - FAMILY_ALIGNMENT_LOW

# ==================================================
# GUIDING VISION PRINCIPLE (FIXED, NON-VARIANT)
# ==================================================

family_guiding_vision_principle:
  required: true
  variant_allowed: false
  allowed_template_keys:
    - FAMILY_GUIDING_VISION_PRINCIPLE

# ==================================================
# INTERNAL / NON-UI BLOCKS
# ==================================================

internal_blocks:
  rendering_footer:
    allowed_template_keys:
      - VISION_RENDER_STATUS
    enabled_for_ui: false
